    async def run_story(
        self,
        story: AgentStory,
        glm_client: Any,
        output_dir: Path,
        deterministic_only: bool = False,
    ) -> StoryResult:
        """Run a full story."""
        result = StoryResult(story_id=story.id, status="pass")
        
        for step in story.steps:
            if deterministic_only and not step.deterministic:
                logger.info(f"  ⏭️ Skipping non-deterministic step: {step.description}")
                continue
                
            step_res = await self._run_step(step, glm_client, output_dir)
            result.steps.append(step_res)
            
            if step_res.status != "pass":
                result.status = "fail"
                # Check for specific classifications like auth_failed if they surfaced in steps
                if any("auth" in str(e.message).lower() for e in step_res.errors):
                    result.classification = "auth_failed"
                break
                
        return result

    async def _run_step(
        self, step: Any, glm_client: Any, output_dir: Path
    ) -> StepResult:
        """Run a single step (either deterministic or LLM)."""
        # ... logic to call _execute_deterministic_step or LLM ...
