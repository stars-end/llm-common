#!/bin/bash
echo "ðŸ”„ [dx-hooks] Checking environment integrity..."
if [ -f .beads/issues.jsonl ] && command -v bd &> /dev/null; then
    # bd import (removed --no-auto-sync per feedback)
    bd import 2>/dev/null || true
fi
if [ -f pnpm-lock.yaml ] && command -v pnpm &> /dev/null; then
    if git diff --name-only HEAD@{1} HEAD 2>/dev/null | grep -q "pnpm-lock.yaml"; then
        echo "ðŸ”„ [dx] pnpm-lock changed. Installing..."
        pnpm install --frozen-lockfile >/dev/null 2>&1 || echo "âš ï¸ pnpm install failed."
    fi
fi
if [ -f .gitmodules ]; then
    if git diff --name-only HEAD@{1} HEAD 2>/dev/null | grep -q "packages/llm-common"; then
        echo "ðŸ”„ [dx] Submodules changed. Updating..."
        git submodule update --init --recursive >/dev/null 2>&1 || true
    fi
fi
exit 0
